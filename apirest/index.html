<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
</head>

<body>
    <div class="m-3 p-3 bg-light shadow">
        <h1 class="m-3 p-3">API Rest TESTER</h1>
        <div class="m-3 p-3">
            <h3>Datos de la peticion</h3><br />
            Id Producto: <input type="text" id="id_producto" class="form-control"><br />
            Nombre Producto: <input type="text" id="nombre_producto" class="form-control"><br />
            Marca Producto: <input type="text" id="marca_producto" class="form-control"><br />
            Costo Producto: <input type="number" min="1" id="costo_producto" class="form-control"><br />
            Precio Venta: <input type="number" min="1" id="precio_producto" class="form-control"><br />
            Fecha Vencimiento: <input type="date" id="fecha_producto" class="form-control"><br />
            <select id="tipo_peticion">
                <option value="GET" selected>get Producto</option>
                <option value="GETALL">getALL Productos</option>
                <option value="POST">post Producto</option>
                <option value="DELETE">delete Producto</option>
                <option value="PUT">put Producto</option>
                <option value="PATCH">patch Producto</option>
            </select>
            <input type="button" class="btn btn-primary" onclick="ejecutarPeticionAPI()"
                value="Realizar Peticion a la API">
        </div>
        <div class="m-3 p-3">
            <h3>Respuesta del Servidor</h3>
            <div id="respuesta" class="border border-5 shadow bg-light">

            </div>
        </div>
    </div>
    <script>
        let url = "http://localhost:8080/";
        function ejecutarPeticionAPI() {
            let tipoPeticion = document.getElementById("tipo_peticion").value;
            document.getElementById("respuesta").innerHTML = "";
            switch (tipoPeticion) {
                case "GET":
                    var id_producto = document.getElementById("id_producto").value;
                    let respuestaget = doRequest(url + "producto", { id: id_producto }, "GET");
                    let productoGet = JSON.parse(respuestaget);
                    if (productoGet["data"] != "El producto no fue encontrado.") {
                        document.getElementById("nombre_producto").value = productoGet.data.nombre;
                        document.getElementById("marca_producto").value = productoGet.data.marca;
                        document.getElementById("costo_producto").value = productoGet.data.costo;
                        document.getElementById("precio_producto").value = productoGet["data"].precioventa;
                        document.getElementById("fecha_producto").value = Date.parse(productoGet["data"].fecha_vencimiento);
                    }
                    document.getElementById("respuesta").innerHTML = respuestaget;
                    break;
                case "GETALL":
                    let respuestagetall = doRequest(url + "productos", {}, "GET");
                    document.getElementById("respuesta").innerHTML = respuestagetall;
                    break;
                case "POST":
                    //nombre, marca, costo, precioventa, fecha_vencimiento
                    let datapost = {
                        nombre: document.getElementById("nombre_producto").value,
                        marca: document.getElementById("marca_producto").value,
                        costo: document.getElementById("costo_producto").value,
                        precioventa: document.getElementById("precio_producto").value,
                        fecha_vencimiento: document.getElementById("fecha_producto").value
                    }
                    let respuestapost = doRequest(
                        url + "producto", datapost, "POST"
                    );
                    document.getElementById("respuesta").innerHTML = respuestapost;
                    break;
                case "DELETE":
                    let respuestaDelete = doRequest(
                        url + "producto", { id: id_producto }, "DELETE"
                    );
                    document.getElementById("respuesta").innerHTML = respuestaDelete;
                    break;
                case "PUT":
                    let dataupdate = {
                        id: document.getElementById("id_producto").value,
                        nombre: document.getElementById("nombre_producto").value,
                        marca: document.getElementById("marca_producto").value,
                        costo: document.getElementById("costo_producto").value,
                        precioventa: document.getElementById("precio_producto").value,
                        fecha_vencimiento: document.getElementById("fecha_producto").value
                    }
                    let respuestaUpdate = doRequest(
                        url + "producto",
                        dataupdate,
                        "PUT"
                    );
                    document.getElementById("respuesta").innerHTML = respuestaUpdate;
                    break;
                case "PATCH":
                    break;
            }
        }
        function doRequest(url, data, method) {
            let response = $.ajax({
                type: method,
                url: url,
                data: data,
                cache: false,
                async: false
            });
            console.log(response);
            return response.responseText;
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</body>

</html>